---
layout: page-sidenav
group: "Chapter. 11"
title: "1. Basic Sampling Algo."
---

### 11.1.1 표준 분포 (Standard distributions)

- 이제 비균등 분포에서 난수를 생성하는 방법을 살펴보자.
- 비균등 분포로부터 난수를 발생시키는 경우에도 기본적으로 균등 분포로부터 시작하는 경우가 많다.
- 따라서 일단 균등 분포(uniform distribution)를 이용하여 난수 발생기를 먼저 고러해보자.
    - 그리고 이를 통해 생성된 \\(0 ~ 1\\( 사이의 값을 \\(z\\) 라고 하자.
- 우리는 어떤 변환 함수 \\(f\\) 를 이용하여 이 \\(z\\) 값을 적절히 변환할 것이다.
- 따라서 이에 대한 변환식으로 \\(y=f(z)\\) 인 어떤 식을 고려할 수 있다.
- 그리고 \\(y\\) 에 대한 확률식을 고려한다. (변환식 또한 확률 분포이기 때문에)

$$p(y)=p(z)\left|\frac{dz}{dy}\right|\qquad{(11.5)}$$

- 당연히 \\(p(z)\\) 는 균등 분포이다. 따라서 \\(p(z)==1\\)이 성립한다.
    - 균등분포인데다가 출력 범위가 \\(0~1\\) 이기 때문이다.
- 이제 여기서 확률식의 적분식을 고려할 것이다. (즉, CDF)

$$z \equiv h(y) \equiv \int_{-\infty}^{\infty}p(\hat{y})d\hat{y}\qquad{(11.6)}$$

- 이는 특정 지점 \\(y\\) 까지의 \\(CDF\\) 값이고 이 식을 새로운 함수 \\(h\\) 로 정의힌다.
- 이를 \\(y\\) 에 대한 함수로 기술해보면 결국 \\(y=h-1(z)\\) 가 된다.
- 무슨 말인지 잘 이해가 가지 않는다면 아래 그림을 보자.

![figure11.2]({{ site.baseurl }}/images/Figure11.2.png){:class="center-block" height="200px"}

- 쉽게 생각해보자면 균등(uniform) 분포를 통해 세로 축의 값을 임의로 생성하는 것이다.
- 그러기 위해 구하고자 하는 함수 \\(p(y)\\) 에 대해 \\(CDF\\) 함수 \\(h(y)\\) 를 구한다.
- \\(h(y)\\) 의 역함수가 균등 분포로 생성된 값이 될 것이므로 이에 대한 역함수 값을 구해 가로 축의 값을 구한다.
- 이 값이 바로 \\(p(y)\\) 분포에서 생성된 샘플 \\(y_0\\) 가 될 것이다.


- 간단한 예를 살펴보도록 하자.
    - 어떤 \\(y\\) 에 대한 확률 함수가 지수 분포(exponential distribution)를 따른다고 생각해보자.
    - 즉, 우리는 이 분포로부터 임의의 샘플을 생성하고 싶은 것이다.

$$p(y) = \lambda \exp(-\lambda y)\qquad{(11.7)}$$

- 이 때의 입력 범위는 \\(0 \le y \le \infty\\) 이다.
- 일단 위의 방식을 적용하기 위해서는 이 식에 대한 \\(CDF\\) 를 구할 수 있어야 한다.

$$z=h(y)=\int_0^{y}p(\hat{y})d\hat{y} = 1 + \exp(-\lambda y)$$

- 이에 대한 역변환을 구할 수 있으면 된다. 다음 식을 참고하자.

$$y = -\lambda^{-1}\ln(1-x)$$

- 교재에는 생략이 되어 있지만 친철하게 한번 정리해 봤다.
- 바로 다음 예제 들어간다.
    - 코쉬(Cauchy) 분포를 샘플링 하는 방법을 간단하게 살펴보자.
    
$$p(y) = \frac{1}{\pi}\frac{1}{1+y^2}\qquad{(11.8)}$$

- 이 함수를 위의 방식대로 \\(CDF\\)를 구하고 역함수를 구하는 방식으로 전개하면 \\(\tan(\dot)\\) 함수를 얻게 된다.
- 마지막으로 이러한 변환식을 고차원으로도 일반화 가능한데, 다음의 식을 이용하면 된다.

$$p(y_1,...,y_M)=p(z_1,...,z_M)\left|\frac{\partial(z_1,...,z_M)}{\partial(y_1,...,y_M)}\right|\qquad{(11.9)}$$

#### Box-Muller Method

- 사실 이런 저런 잘 쓰지도 않을 허접한 분포들로부터 샘플을 생성하는 방법을 고민할 때가 아니다.
- 일단 가장 먼저 가우시안 분포로부터 샘플을 어떻게 생성할 것인지를 생각해야 한다. (가장 자주 사용되므로)
- 가우시안 분포도 위와 같은 방식으로 처리하면 뭐, 크게 무리 없게 전개가 가능하기는 하다.
- 하지만 여기서는 다변량 가우시안 분포를 고려할 것이다.
- 이 경우 \\(N\\) 차원의 데이터가 서로 상관 관계가 있기 때문에 단순한 방식으로는 생성이 쉽지 않다.

- 가장 먼저 난수 생성기의 생성 범위가 좀 다르다.
- \\((-1, 1)\\) 사이의 난수가 발생한다. (즉, \\((0, 1)\\) 이 아니다)
- 일단 문제를 간단하게 접근하기 위해 2차원의 데이터만을 고려하도록 하자.
- 발생되는 난수를 각각 \\(z_1\\) 와 \\(z_2\\) 라고 하자.
- \\(-1\\) 과 \\(1\\) 사이의 난수는 기존의 \\((0, 1)\\) 난수 발생기를 \\(z\_{new} = 2z\_{old}-1\\) 을 이용하면 쉽게 생성할 수 있다.
- 그리고 이렇게 생성된 2개의 난수가 **다음의 조건을 만족하는 경우에만 채택**하도록 한다.

$$z_1^2 + z_2^2 \le 1$$

- 즉, 원 안의 점들에 포함되는 경우에만 채택하도록 한다.
- 균등 분포로 발생되었으므로 내부 원 안에서 발생될 확률은 모두 동일하게 된다.
- 실제 확률 값은 \\(p(z_1, z_2) = \frac{1}{\pi}\\) 가 된다.

![figure11.3]({{ site.baseurl }}/images/Figure11.3.png){:class="center-block" height="130px"}

- 이로부터 변환된 좌표를 만들어보자.

$$y_1 = z_1 \left(\frac{-2\ln r^2}{r^2}\right)^{\frac{1}{2}}\qquad{(11.10)}$$

$$y_2 = z_2 \left(\frac{-2\ln r^2}{r^2}\right)^{\frac{1}{2}}\qquad{(11.11)}$$

- 위의 식은 원 내에 균등 분포로 생성된 샘플을 표준 가우시안 분포로 변환해주는 식이다.
- 어떻게 이런 식으로 전개되는지 찾아보다가 지쳐서 포기했다.
    - 극좌표 전환을 적절히 하다보면 나오는 것 같다.
    - 관심이 생긴다면 위키피디아를 참고하도록 하자. ( [링크](https://en.wikipedia.org/wiki/Box%E2%80%93Muller_transform) )
- 이를 이용하여 \\(p(y1, y2)\\) 의 확률을 정의할 수 있다.

$$p(y_1, y_2) = p(z_1, z_2)\left|\frac{\partial(z_1, z_2)}{\partial(y_1, y_2)}\right| = \left[\frac{1}{\sqrt{2\pi}}\exp\left(\frac{-y_1^2}{2}\right)\right]\left[\frac{1}{\sqrt{2\pi}}\exp\left(\frac{-y_2^2}{2}\right)\right]\qquad{(11.12)}$$


- 이렇게 해서 끝나는 것은 아닌데 이것으로 얻을 수 있는 분포는 평균이 \\(0\\)이고 공분산이 \\(I\\) 인 단위 가우시안 분포이다.
    - 따라서 \\(y_1\\) 와 \\(y_2\\) 는 서로 독립적이다.
- 실제 우리가 원하는 샘플은 특정 평균값과 특정 공분산을 가지는 가우시안 분포에서의 샘플이다.
    - 그런데 사실 이와 관련된 내용은 이미 2장에서 조금 다루었다.
    - 2개의 차원을 가지는 임의의 가우시안 분포를 서로 독립적인 가우시안 분포로 변환하는 방법을 2장에서 이미 다루었다.
    - 따라서 적절한 변환으로 다른 가우시안 분포를 만들어 낼 수 있다는 의미
    - 주어진 단위 분포로부터 평균이 \\(\mu\\) 이고 공분산이\\(\Sigma\\) 인 분포를 만들기 위해서는
    - \\(y = \mu + Lz\\)  로 변환하면 된다. 여기서\\(L) \\(\Sigma = LLT\\) 로부터 촐레스키 분해(*Cholesky decomposition*) 를 통해 얻을 수 있다.
    
- 지금까지 살펴본 방식은 매우 유용한 방식이지만,
    - 주어진 분포가 매우 간단하여 적분과 역변환기 가능한 분포에서만 사용할 수 있다.
    - 따라서 이런 방식을 적용할 수 없는 분포에서는 좀 더 일반화된 방식을 사용해야 한다.
    - 앞으로 다음의 방법들을 살펴볼 것이다.
        - *rejection sampling*
        - *importance sampling*
    - 근데 이러한 방식도 사실 단일(univariant) 분포에서나 사용 가능한 방식이다.

### 11.1.2 Rejection Sampling

- 보통 채택-기각 샘플링이라고 하던데, 여기서는 그냥 기각 샘플링이라고 하자.
- 기각 샘플링은 복잡한 분포로부터 샘플을 추출할 수 있는 프레임워크이다.
    - 여기서는 단일 분포에서의 샘플 추출만을 고려하도록 한다.
    - 왜 그런지는 후반부에 설명되어 있다.
- 우리가 샘플링하고 싶은 분포 \\(p(z)\\) 가 주어졌다고 생각해보자.
- 그런데 이 분포는 좀 복잡한 형태를 취하고 있기 때문에 바로 샘플을 생성할 수는 없다.
- 좀 더 가정을 넣어보자.
    - 주어진 \\(p(z)\\) 에서 샘플을 직접 생성하기는 매우 어렵지만, 반면 정규화되지 않은 \\(p(z)\\)의 식은 구하는게 가능하다고 생각해보자.
    - 조금 억지같지만, 사실 지금까지 다룬 분포들이 이러한 형태가 많았다. (사후 분포의 형태가 사실 이런 식이다.)
    - 여기서는 정규화 계수 \\(Z\\) 를 도입하여 정규화되지 않은 분포에 대해 다룰 수 있도록 한다.

$$p(z) = \frac{1}{Z_p}\hat{p}(z)\qquad{(11.13)}$$

- 물론 여기서 \\(Z_p)\\) 의 값은 알지 못한다. (알면 이런 짓을 하지 않았을 것이다.)
- 기각 샘플링 기법을 만들어내기 위해서는 새로운 분포 \\(q(z)\\) 를 도입해야 한다.
    - 이런 분포를 *Proposal* 분포라고 한다. (한글로는 제안 분포라 해야하나?)
    - 이 분포에 대한 가정은 이 분포에서 샘플 생성이 가능하다는 것이다.
        - 앞절에서 살펴보았던 다양한 분포들을 떠올려보자.
    - 이제 다음으로 상수 \\(k\\) 에 대해 알아보자.
        - 앞서 이야기했지만 사용되는 실제 분포는 정규화되지 않은 분포이다.
        - 이제 \\(q(z)\\) 에 상수 \\(k\\) 를 곱한 값을 사용한다.
    - 이 때 \\(k q(z) \ge \widehat{p}(z)\\) 를 만족하는 가장 작은 \\(k\\) 를 사용할 것이다.
    

- - -
(작성중)
- - -
